- id: turn_on_lights_on_sunset
  alias: Turn on lights on Sunset
  trigger:
    platform: state
    entity_id: sun.sun
    to: 'below_horizon'
  condition:
    - condition: state
      entity_id: group.family
      state: 'home'
    - condition: state
      entity_id: group.living_room_lights
      state: 'off'
    - condition: state
      entity_id: group.bedroom_lights
      state: 'off'
  action:
    - service: script.announcement
      data:
        notify: false
        greetings:
          - '–í–µ—á–æ—Ä—ñ—î.'
          - '–°–∫–æ—Ä–æ —Å—Ç–µ–º–Ω—ñ—î.'
          - '–°–æ–Ω–µ—á–∫–æ –∑–∞–π—à–ª–æ –∑–∞ –æ–±—Ä—ñ–π.'
          - '–°–∫–æ—Ä–æ –≤–¥–æ–º–∞ —Å—Ç–∞–Ω–µ —Ç–µ–º–Ω–æ.'
          - '–°–æ–Ω—Ü–µ –æ–ø—É—Å—Ç–∏–ª–æ—Å—å –∑–∞ –æ–±—Ä—ñ–π.'
        messages:
          - '–î–æ—Ä–µ—á–Ω–æ —É–≤—ñ–º–∫–Ω—É—Ç–∏ —Å–≤—ñ—Ç–ª–æ.'
          - '–í–º–∏–∫–∞—î–º–æ —Å–≤—ñ—Ç–ª–æ.'
          - '–í–º–∏–∫–∞—é —Å–≤—ñ—Ç–ª–æ.'
          - '–ß–∞—Å —É–≤—ñ–º–∫–Ω—É—Ç–∏ —Å–≤—ñ—Ç–ª–æ.'
          - '–í–º–∏–∫–∞—é –¥–ª—è –≤–∞—Å —Å–≤—ñ—Ç–ª–æ.'
          - '–í–º–∏–∫–∞—é –≤–µ—á—ñ—Ä–Ω—î —Å–≤—ñ—Ç–ª–æ.'
    - service: scene.turn_on
      data:
        entity_id: scene.evening_lights
        transition: 5

- id: turn_on_lights_on_low_illuminance
  alias: Turn on lights on low illuminance
  trigger:
    - platform: numeric_state
      entity_id: sensor.living_room_movement_sensor_illuminance_lux
      below: 50
    - platform: numeric_state
      entity_id: sensor.bedroom_movement_sensor_illuminance_lux
      below: 10
  condition:
    - condition: state
      entity_id: group.family
      state: 'home'
    - condition: state
      entity_id: sun.sun
      state: 'above_horizon'
    - condition: state
      entity_id: group.living_room_lights
      state: 'off'
    - condition: state
      entity_id: group.bedroom_lights
      state: 'off'
    - condition: state
      entity_id: binary_sensor.activity_time
      state: 'on'
  action:
    - service: script.announcement
      data:
        notify: false
        greetings:
          - '–ó–¥–∞—î—Ç—å—Å—è –≤–¥–æ–º–∞ –Ω–∞–¥—Ç–æ —Ç–µ–º–Ω–æ.'
          - '–í–¥–æ–º–∞ –∑–∞–Ω–∞–¥—Ç–æ —Ç–µ–º–Ω–æ.'
          - '–°—Ç–µ–º–Ω—ñ–ª–æ.'
          - '–°–æ–Ω—Ü–µ —Å—Ö–æ–≤–∞–ª–æ—Å—å –∑–∞ —Ö–º–∞—Ä–∞–º–∏.'
          - '–ù–∞–¥—Ç–æ —Ç–µ–º–Ω–æ.'
          - '–í–¥–æ–º–∞ –∑–∞ —Ç–µ–º–Ω–æ.'
        messages:
          - '–î–æ—Ä–µ—á–Ω–æ —É–≤—ñ–º–∫–Ω—É—Ç–∏ —Å–≤—ñ—Ç–ª–æ.'
          - '–£–≤—ñ–º–∫–Ω—É –¥–ª—è –≤–∞—Å —Å–≤—ñ—Ç–ª–æ.'
          - '–ö—Ä–∞—â–µ —É–≤—ñ–º–∫–Ω—É—Ç–∏ —Å–≤—ñ—Ç–ª–æ.'
          - '–ù–µ –±—É–¥–µ–º–æ –ø—Å—É–≤–∞—Ç–∏ –æ—á—ñ.'
          - '–í–º–∏–∫–∞—é –¥–ª—è –≤–∞—Å —Å–≤—ñ—Ç–ª–æ.'
          - '–í–º–∏–∫–∞—î–º–æ —Å–≤—ñ—Ç–ª–æ.'
          - '–í–º–∏–∫–∞—é —Å–≤—ñ—Ç–ª–æ.'
          - '–ß–∞—Å —É–≤—ñ–º–∫–Ω—É—Ç–∏ —Å–≤—ñ—Ç–ª–æ.'
    - service: scene.turn_on
      data:
        entity_id: scene.evening_lights
        transition: 5

- id: turn_on_corridor_light_when_door_is_open
  alias: Turn on Corridor Light When Door is Open
  mode: restart
  trigger:
    - platform: state
      entity_id: binary_sensor.front_door_sensor_contact
      to: 'on'
  action:
    - alias: Turn on Corridor Light
      service: light.turn_on
      entity_id: light.corridor_light
    - alias: Wait for some time
      delay:
        minutes: 5
    - alias: Turn off Corridor Light
      service: light.turn_off
      entity_id: light.corridor_light

- id: turn_off_corridor_light_when_door_is_closed
  alias: Turn off Corridor Light When Door is Closed
  mode: restart
  trigger:
    - platform: state
      entity_id: light.corridor_light
      to: 'on'
  action:
    - wait_for_trigger:
        - platform: state
          entity_id: binary_sensor.front_door_sensor_contact
          from: 'on'
          to: 'off'
      timeout:
        minutes: 15
    - choose:
        - conditions: '{{ wait.trigger is not none }}'
          sequence:
            - delay:
                minutes: 2
            - service: light.turn_off
              entity_id: light.corridor_light
      default:
        - variables:
            turn_off_corridor_light: "{{ 'TURN_OFF_CORRIDOR_LIGHT' ~ context.id }}"
        - service: script.announcement
          data:
            title: '–°–≤—ñ—Ç–ª–æ —É –∫–æ—Ä–∏–¥–æ—Ä—ñ üí°'
            speak: false
            greetings:
              - –°–≤—ñ—Ç–ª–æ —É –∫–æ—Ä–∏–¥–æ—Ä—ñ –≥–æ—Ä–∏—Ç—å –≤–∂–µ 15 —Ö–≤–∏–ª–∏–Ω.
              - –°–≤—ñ—Ç–ª–æ —É –∫–æ—Ä–∏–¥–æ—Ä—ñ –¥–æ—Å—ñ –≥–æ—Ä–∏—Ç—å.
              - –î–æ—Å—ñ –≥–æ—Ä–∏—Ç—å —Å–≤—ñ—Ç–ª–æ —É –∫–æ—Ä–∏–¥–æ—Ä—ñ.
            messages:
              - '–í–∏–º–∫–Ω—É—Ç–∏?'
              - '–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å —ñ –ø–æ—Ç—Ä–∏–º–∞–π—Ç–µ –Ω–∞ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è, —â–æ–± –≤–∏–º–∫–Ω—É—Ç–∏.'
              - '–ì–ª–∏–±–æ–∫–µ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—è –Ω–∞ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è, —â–æ–± –≤–∏–º–∫–Ω—É—Ç–∏.'
              - '–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å, —â–æ–± –≤–∏–º–∫–Ω—É—Ç–∏.'
            notify_data:
              actions:
                - action: '{{ turn_off_corridor_light }}'
                  title: –í–∏–º–∫–Ω—É—Ç–∏ —Å–≤—ñ—Ç–ª–æ
              url: /lovelace/living_room
        - wait_for_trigger:
            - platform: event
              event_type: mobile_app_notification_action
              event_data:
                action: '{{ turn_off_corridor_light }}'
          timeout:
            hours: 1
          continue_on_timeout: false
        - service: light.turn_off
          entity_id: light.corridor_light
