#
# Multiscrape
#
# https://github.com/danieldotnl/ha-multiscrape
#

multiscrape:
  - name: War Monitor
    resource: https://t.me/s/war_monitor
    scan_interval: 5
    list_separator: '|||'
    binary_sensor:
      - unique_id: danger_in_war_monitor
        name: Danger in War Monitor
        icon: mdi:rocket-launch
        device_class: safety
        select_list: '.js-message_text'
        value_template: >-
          {% set message = value.split("|||") | last | lower %}
          {% set in_kyiv = "ÐºÐ¸Ñ—Ð²" in message or "ÑÐ²ÑÑ‚Ð¾ÑˆÐ¸Ð½" in message %}
          {% set danger_now = "ÑƒÐ²Ð°Ð¶Ð½Ð¾" in message
              or "ÑˆÐ²Ð¸Ð´ÐºÑ–ÑÐ½Ð° Ñ†Ñ–Ð»ÑŒ" in message
              or "Ð¿Ð¾Ð´Ð°Ð»Ñ– Ð²Ñ–Ð´ Ð·Ð¾Ð²Ð½Ñ–ÑˆÐ½Ñ–Ñ… ÑÑ‚Ñ–Ð½" in message
              or "Ð±ÐµÐ·Ð¿ÐµÑ‡Ð½Ð¸Ñ… Ð¼Ñ–ÑÑ†ÑÑ…" in message
          %}
          {{ danger_now and in_kyiv }}
        attributes:
          - name: latest_message
            select_list: '.js-message_text'
            value_template: "{{ value.split('|||') | last }}"
      - unique_id: imminent_attack_in_war_monitor
        name: Imminent Attack in War Monitor
        icon: mdi:airplane-clock
        device_class: safety
        select_list: '.js-message_text'
        value_template: >-
          {% set message = value.split("|||") | last | lower %}
          {{ "Ð·Ð»Ñ–Ñ‚" in message and "Ð±Ð¾Ñ€Ñ‚Ñ–Ð²" in message and "Ñ‚Ñƒ-95" in message }}
        attributes:
          - name: latest_message
            select_list: '.js-message_text'
            value_template: "{{ value.split('|||') | last }}"

  - name: Operinform
    resource: https://t.me/s/operinform
    scan_interval: 5
    list_separator: '|||'
    binary_sensor:
      - unique_id: danger_in_operinform
        name: Danger in Operinform
        icon: mdi:rocket-launch
        device_class: safety
        select_list: '.js-message_text'
        value_template: >
          {% set message = value.split("|||") | last | lower %}
          {% set in_kyiv = "ÐºÐ¸Ñ—Ð²" in message or "ÑÐ²ÑÑ‚Ð¾ÑˆÐ¸Ð½" in message %}
          {% set danger_indicator = "ðŸ”´" in message %}
          {% set danger_now = "ÐºÐ¸Ñ—Ð²!" in message
              or "Ð±ÑƒÐ´Ðµ Ð³ÑƒÑ‡Ð½Ð¾" in message
              or "Ð±ÑƒÑ‚Ð¸ Ð³ÑƒÑ‡Ð½Ð¾" in message
              or "ÐºÐ¸Ð½Ð´Ð¶Ð°Ð» Ð½Ð°" in message
              or "Ð±Ð°Ð»Ñ–ÑÑ‚Ð¸ÐºÐ° Ð½Ð°" in message
          %}
          {{ danger_indicator and danger_now and in_kyiv }}
        attributes:
          - name: latest_message
            select_list: '.js-message_text'
            value_template: "{{ value.split('|||') | last }}"

      - unique_id: imminent_attack_in_operinform
        name: Imminent Attack in Operinform
        icon: mdi:airplane-clock
        device_class: safety
        select_list: '.js-message_text'
        value_template: >-
          {% set message = value.split("|||") | last | lower %}
          {{ "Ð·Ð»Ñ–Ñ‚" in message and "Ð±Ð¾Ñ€Ñ‚Ñ–Ð²" in message and "Ñ‚Ñƒ-95" in message }}
        attributes:
          - name: latest_message
            select_list: '.js-message_text'
            value_template: "{{ value.split('|||') | last }}"
