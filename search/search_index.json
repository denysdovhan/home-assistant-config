{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Welcome to my Home Assistant Config!","text":"HomeLiving RoomBedroomBalconySystem <p>This is my personal Home Assistant configuration, awakening my home with automations. I hope this will help you inspire to start your home automation journey.</p> <p>Beware of changes</p> <p>I constantly improve my home. It evolves as I add new devices and services. It's changing as my daily routines are changing.</p> <p>Please, keep in mind this documentation might be outdated in covering some details. However, I'll try my best to keep this updated.</p> <p>The best way to discover new ideas and inspire is by reading the code, copying-pasting parts of my configuration and adjusting it to your needs.</p> <p>Read this documentation to see the bigger picture:</p> <p>Hardware Configuration Inspiration</p> <p>Documentation for the rest of the stuff that I run on my smart home server can be found here:</p> <p>Smart Home</p>"},{"location":"#whats-inside","title":"What's inside?","text":"<p>My home setup for those who are too lazy to read everything:</p> <ul> <li>Home Assistant OS run as a virtual machine on Beelink Mini S12 Pro as a home server.</li> <li>Home Assistant for home automations.</li> <li>Mosquitto and zigbee2mqtt for Zigbee devices.</li> <li>Reverse proxy using Nginx Proxy Manager with CloudFlare.</li> </ul>"},{"location":"#motivation","title":"Motivation","text":"<p>I write this documentation for two main reasons:</p> <ol> <li>To keep track of growing my smart home. To maintain an understanding of how things are working.</li> <li>To help other enthusiasts inspire. People often ask about my smart home setup. Now I can give them a link to this documentation, instead of explaining everything once again.</li> </ol>"},{"location":"#limitations","title":"Limitations","text":"<p>I'm renting my apartment. My landlord handles fixing stuff in my home, covering all the expenses. The only downside is that I can't change anything in my home.</p> <p>I can't disassemble anything and use custom switches or sockets. It means I can change only easily accessible parts, like bulbs.</p>"},{"location":"#future-plans","title":"Future Plans","text":"<p>I have a public Notion board with ideas and tasks for my smart home. You can follow and comment my plans there.</p> <p>See future plans</p>"},{"location":"#license","title":"License","text":"<p>MIT \u00a9 Denys Dovhan</p>"},{"location":"hardware/","title":"Hardware","text":"<p>This is the list of the hardware that is present in my smart home.</p> <p>You can read more about what I host on my smart-home here:</p> <p>Smart Home Documentation</p>"},{"location":"hardware/#homelab-server","title":"Homelab Server","text":"<p>My homelab server is running on Beelink Mini S12 Pro with Intel 12th Gen 4-Cores N100 (up to 3.4GHz), 16GB of RAM and 500GB of SSD memory.</p> <p>It can easily run multiple VMs or LXCs, transcode a few 4K streams, while staying quite and consuming only 8.2 watts at idle and 22.5 watts on max load. It's also very small \u2013 a little larger than Apple TV box. This combination of characteristics makes it a perfects smart home server.</p> Beelink Mini S12 ProPackaging <p></p> <p></p> <p>I use Seagate Barracuda 2TB 5400rpm 128MB as a hard driver for media files. 2TB is not much, but there's no much room withing the mini PC casing. I'll work on a better NAS solution in the future. Here's how it looks when open:</p> <p></p> Previous setup with Raspberry Pi 4B <p>The heart of my smart home is a home server based on Raspberry Pi 4 Model B with 4GB of RAM onboard. It's a small, affordable, but nonetheless a very capable device. It's held within an aluminum alloy case I bought on AliExpress. The aluminum case itself helps to disperse heat. Additionally, it came with a heat sink set and a tiny cooling fan.</p> <p>I use official Raspberry Pi 15W USB-C Power Supply for powering my smart home server. It is important to get enough power for Raspberry Pi to work properly. Home Assistant requires at least 3A power and this power supply cable handles it just right.</p> Home Server HardwareAlluminium Case AssemblingAssembled and Connected <p>Here's a photo of my home server hardware, right after I received it:</p> <p></p> <p>A photo of the aluminum case when I was assembling it:</p> <p></p> <p>Here's a whole kit assembled and connected to power:</p> <p></p> Previous media storage solution with external HDD <p></p> <p>I've got a Transcend StoreJet 25M3 2TB hard drive from my dad as my birthday present in 2020.</p> <p>I have this HDD connected to my Raspberry Pi. It is used as a storage for my media files (primarly movies and TV-series). USB 3.0 interface on Raspberry allows high speed reading, so I can easily stream my media using Plex.</p> <p>Media is downloaded directly to my HDD using Transmission container.</p>"},{"location":"hardware/#storage","title":"Storage","text":"<p>I use Kingston SSDNow A400 240GB 2.5\" as a system data storage. It's connected to Raspberry Pi via Ugreen US221 USB 3.0 case adapter. As a media storage I use Transcend StoreJet 25M3 2TB hard drive (which I got from my dad as my birthday present in 2020). Both storages are connecterd via USB 3.0 interface on Raspberry to allow high speed reading, so I can easily stream my media using Plex.</p> <p>Media is downloaded directly to my HDD using Transmission container.</p> SSD and HDD Assembled and ConnectedSSD whithin a CaseHDD Connected <p></p> <p></p> <p></p>"},{"location":"hardware/#installation","title":"Installation","text":"<p>A few words on how Home Assistant is run on my homelab server.</p> <p>Home Assistant OS is run as a VM on a Proxmox VE. My hardware is too powerful to run only Home Assistant. Proxmox allows me to host multiple servers as LXCs and VMs on a single physical machine.</p> <p>There are multiple guides on how to install HA in Proxmox.</p> <p>Over time I tried practically all of the ways to run Home Assistant: I used it as OS on Raspberry Pi \u2192 I used to run in as Supervised on Debian \u2192 I ran it as a Container in Docker on Ubuntu Server \u2192 Now I'am back to OS, but in Virtual Environment.</p>"},{"location":"hardware/#wifi-network","title":"WiFi Network","text":"<p>You're going to have a lot of devices in your network when you have a smart home. It's critical to choose a good router to handle multiple devices and heavy traffic.</p>"},{"location":"hardware/#wireless-router","title":"Wireless Router","text":"<p>The second most important thing in my smart home is a WiFi router.</p> <p>I've spent a lot of time choosing the right router. My main requirements for the router were:</p> <ul> <li>Dual-band: 2.4GHz and 5GHz \u2014 Primarily, I use two networks in my home: 2.4GHz for smart devices and 5GHz for personal devices like phones and laptops. 5GHz uses shorter radio waves, and that provides faster speeds.</li> <li>MU-MIMO \u2014 This is a technology that enables simultaneous communication to multiple devices, improving overall speed and enabling network multitasking. It is critical when you have lots of connected devices and want each of them to work with the highest speed.</li> <li>802.11ac \u2014 this is a so-called WiFi5 standard. It allows increased speeds and improved scalability. I have a gigabyte connection at my home and wanted to benefit from it.</li> </ul> <p>I chose ASUS RT-AC1750U router for my home. It matches every condition above and has nice additional features. Also, I've noticed that routers by ASUS are quite respected among other smart-home enthusiasts.</p> <p>I'm happy with my decision so far. This router gives the constant 600-900 Mbit/s speed, which is enough to download a 10GB file in less than 2 minutes.</p> <p>Previously, I've also tried Xiaomi Router and wasn't happy about it. Xiaomi Router has UI in Chinese and worked unreliably overall.</p> <p>Here are my current ASUS and former Xiaomi routers:</p> <p></p>"},{"location":"hardware/#devices","title":"Devices","text":"<p>Below you will find a list of my devices connected to the local network. Most of them, except for Apple TV, have static IP addresses.</p> Device IP HA Integration Apple TV 4K <code>192.168.50.x</code>* Apple TV Koogeek P1EU Smart Plug <code>192.168.50.9</code> HomeKit Controller Koogeek P1EU Smart Plug <code>192.168.50.10</code> HomeKit Controller Koogeek P1EU Smart Plug <code>192.168.50.11</code> HomeKit Controller Samsung 55\" Q67R 4K Smart QLED TV <code>192.168.50.93</code> ha-samsungtv-tizen** Raspberry Pi <code>192.168.50.113</code>* \u2013 Yeelight LED Bulb 1S (Color) <code>192.168.50.128</code> Yeelight Yeelight LED Bulb 1S (Color) <code>192.168.50.129</code> Yeelight Xiaomi Bulb White and Color <code>192.168.50.130</code> Yeelight Xiaomi Desk Lamp Pro <code>192.168.50.131</code> Yeelight PlayStation 4 Pro <code>192.168.50.185</code>* Sony PlayStation 4 Roborock S5 Max <code>192.168.50.186</code> Xiaomi Miio Deerma Humidifier (mjjsq) <code>192.168.50.187</code> xiaomi_airpurifier** Xiaomi Air Purifier 3H <code>192.168.50.188</code> Xiaomi Miio Bedroom HomePod Mini <code>192.168.50.x</code> Apple TV Living Room HomePod Mini <code>192.168.50.x</code> Apple TV living-room-ac <code>192.168.50.x</code> ESPHome bedroom-ac <code>192.168.50.x</code> ESPHome <p>* \u2014 means the device is connected via Ethernet instead of WiFi to ensure a more reliable connection.</p> <p>** \u2014 means the device is integrated via custom integration.</p>"},{"location":"hardware/#esp-devices","title":"ESP-devices","text":"<p>I use two ESP8266 devices based on iot-uni-dongle for controlling my Midea ACs.</p> <p></p>"},{"location":"hardware/#zigbee-network","title":"Zigbee Network","text":"<p>My Zigbee devices are connected to Home Assistant via SMARTLIGHT CC2652P Zigbee USB Adapter SLZB-02 as a coordinator. Devices are controlled by Home Assistant via: zigbee2mqtt + Mosquitto + MQTT Integration.</p> <p>Note</p> <p>Previosly my Zigbee network was working with CC2531 Sniffer Board as a coordinator. It was fine with small amount of devices, but as my network grew I started to get weird behavior. Additioanlly, I've discovered that CC2531 is no longer recommended by zigbee2mqtt developers.</p> <p>Tip</p> <p>I connected my coordinator to the Raspberry Pi through a USB extension cable to avoid interference and improve the connection. This approach is suggested by zigbee2mqtt documentation.</p> <p>I used to use Aqara Hub, but it switched to the current approach because of its compatibility. The current approach allows binding together nearly every possible Zigbee device.</p>"},{"location":"hardware/#devices_1","title":"Devices","text":"Device Quantity Notes Aqara Smart LED Bulb 9W 5 Ceiling and Main lights Aqara Motion Sensor 2 Detecting motions in both rooms Aqara Magic Cube Controller 1 Controlling lights, scenes and modes Aqara Conditions Sensor 1 Internal temperature, humidity and pressure data Aqara Contact Sensor 1 Detection front door opening Aqara Single Switch Module T1 (without neutral) 1 Switching corridor light MiJia Conditions Sensor 1 Internal temperature and humidity data Tuya Smart ZigBee Radiator 2 Adjusting heaters temperature Lonsonho 2-Gang Switch 2 (without neutral) 1 Switching kitchen lights"},{"location":"hardware/#other-devices","title":"Other Devices","text":"<p>Another important device is a smart car alarm. I used StarLine AS96 BT GSM GPS which is easily integrated with Home Assistant via built-in StarLine integration.</p> <p>This alarm allows to start/stop the engine, arm/disarm the alarm, trigger horn remotely via Home Assistant. Primarily, I use this for tracking down my car and checking interior temperature right from Home Assistant.</p>"},{"location":"resources/","title":"Inspiration","text":"<p>On this page, I'm trying to collect useful resources I used to improve my home:</p>"},{"location":"resources/#configurations","title":"Configurations","text":"<ul> <li>MacBury Smart House very cool and complex setup. I was inspired a lot by this.</li> <li>Frenck's Home Assistant Configuration unusual folder structure.</li> <li>Bas Nijholt's Home Assistant config files autogenerated docs for Home Assistant automations. I borrowed and adjusted a Python script for generating a list of automation from here.</li> </ul>"},{"location":"resources/#articles-and-guides","title":"Articles and Guides","text":"<ul> <li>How I set up room-cleaning automation with Google Home, Home-Assistant and Xiaomi vacuum cleaner</li> <li>Actionable Notifications for   Home Assistant</li> </ul>"},{"location":"resources/#youtube-channels","title":"YouTube Channels","text":"<ul> <li>JuanMTech YouTube Channel about general Home Assistant setup. Very high-quality videos.</li> <li>Zack Barett YouTube Channel mostly about Lovelace UI configuration and new Home Assistant features.</li> <li>DrZzs YouTube Channel about almost every possible smart-home related stuff. His hovering talking head might look a bit weird and even creepy, but the content itself is very useful.</li> <li>Grayson Adams about devices overview, basic Home Assistant setup.</li> <li>DB Tech generally about server administration. Mostly about Docker, Portainer, self-hosted services, OpenMediaVault, and Raspberry Pi. Very high-quality videos.</li> <li>Home Automation Guy very friendly and encouraging videos about HA and smart-home devices.</li> </ul>"},{"location":"resources/#youtube-videos","title":"YouTube Videos","text":"<ul> <li>Raspberry Pi 4 Home Server playlist by DB Tech is specifically about smart-home hosted on Raspberry Pi.</li> <li>Super Simple Cloudflare and Nginx Proxy Manager Setup Using YOUR Domain by Geeked</li> <li>CloudFlare - FREE Additional Security For Your Home Server! by DB Tech</li> </ul>"},{"location":"resources/#misc","title":"Misc","text":"<ul> <li>Awesome Home Assistant for general links related to Home Assistant</li> <li>Home Assistant Twitter for news and community interactions</li> </ul>"},{"location":"config/","title":"Configuration","text":"<p>I use Home Assistant as my primary smart home software. It allows me to tied down every separate ecosystem, every device, and every service together.</p> <p>This is a very powerful tool, allowing to built complex and smart automation based on multiple triggers and conditions, performing different actions.</p> <p>So far, I'm happy with Home Assistant and strongly recommend trying it if you are a smart home enthusiast.</p>"},{"location":"config/#prior-art","title":"Prior Art","text":"<p>I began my smart home journey with an Aqara Hub and a few bulbs.</p> <p>In the beginning, I was hoping to consolidate my smart home over HomeKit, because I'd already had a few Apple devices. Shortly after, I run into multiple limitations. After a year of using Aqara setup, I decided to switch to the more universal and powerful solution \u2014 Home Assistant.</p> <p>Now I easily pass my devices to the HomeKit as well as to the Google Home app.</p>"},{"location":"config/#how-i-make-my-automations","title":"How I make my automations","text":"<p>Tip</p> <p>I highly suggest reading a blog post called Perfect Home Automation written by Home Assistant creator Paulus Schoutsen.</p> <p>This article contains valid points about developing home automation. This will help you develop the right mindset while building your smart home.</p> <p>There are a few rules I use while building my smart home:</p> <ul> <li>You should not adapt to technologies. Things should just work. You shouldn't break your own daily routines in order to adapt to your home. Home automation should blend with your current workflow, not replace it.</li> <li>You are not the only user of your home automation. Even when you live alone, you may have guests. Think about how they're going to use your home.</li> <li>Limit the impact of failures. Smart homes are complex: eventually, things will go wrong. Make sure things will have a limited impact when they fail. Ideally, devices should fall back to a pre-smart home experience.</li> <li>Automations must be seamless. Nobody controls lights from the phone except for showing off. This means that everything you automate has to work flawlessly. Even when automation works perfectly 90% of the time, the rest 10% will ruin the whole positive experience.</li> </ul> <p>That's what I keep in mind. This helps a lot.</p>"},{"location":"config/#automations","title":"Automations","text":"<p>Here you can discover all of the automations powering my home. The list is automatically and regularly updated.</p> <ol> <li>\ud83d\udea8 Alarm (2 automation)</li> <li>\ud83d\udd14 Alert (10 automation)</li> <li>\ud83c\udf21\ufe0f Climate (8 automation)</li> <li>\ud83d\udca1 Light (6 automation)</li> <li>\ud83c\udfb5 Media (3 automation)</li> <li>\ud83d\udea6 Mode (4 automation)</li> <li>\ud83d\udd18 Presence (2 automation)</li> <li>\ud83d\udda5\ufe0f System (10 automation)</li> <li>\ud83e\uddf9 Vacuum (8 automation)</li> <li>\ud83d\udca6 Water (2 automation)</li> </ol> <p>Total number of automations: 55\ufe0f</p>"},{"location":"config/#alarm","title":"\ud83d\udea8 Alarm","text":"<ul> <li>Notification for Triggered \u2013 Make an announcement when Alarm is getting triggered</li> <li>Triggering Alarm</li> </ul>"},{"location":"config/#alert","title":"\ud83d\udd14 Alert","text":"<ul> <li>Air Siren in Kyiv \u2013 Air Alert announcement when we are in Kyiv. Sends critical notifications and announces on speakers.</li> <li>Bad Air Quality \u2013 Notify when the air quality is bad</li> <li>Car Washing \u2013 Notify when it\u2019s okay or not okay to wash a car</li> <li>Danger in Kyiv \u2013 Danger of missile/drone strike in Kyiv RIGHT NOW. Critical alert to hide immediately.</li> <li>Denys left the Office \u2013 Notify when Denys is leaving the office</li> <li>Electricity Outage Notification \u2013 Notify everyone when there is no electricity at home.</li> <li>Humidifier No Water \u2013 Notify when humidifier's water tank is empty</li> <li>Imminent Attack by Strategic Bombers \u2013 Send a notification when Tu-95 strategic bombers take off from Russian airfields. This means attack by cruise missiles is imminent. Prepare a hideout.</li> <li>Low Battery Notification \u2013 Notify when battery is low on devices, so we could buy a replacements.</li> <li>Snow/Winter Tires \u2013 Notify when it's time to change car tires</li> </ul>"},{"location":"config/#climate","title":"\ud83c\udf21\ufe0f Climate","text":"<ul> <li>Preheat Balcony for a Workday \u2013 When Denys wakes up, ask if he is going to work on balcony, start heating and notify when temperature is comfortable.</li> <li>Suggest turning on AC when it's hot \u2013 When temperature raises over certain level, send an actionable notification for turning on ACs</li> <li>Switch Heaters during Heating Season \u2013 Turn on/off heaters when Heating Season in on</li> <li>Sync Bedroom TRV temperature</li> <li>Sync Living Room TRV temperature</li> <li>Turn off Balcony Heater \u2013 Turn off Balcony Heater when the working display or desk lamp are off for some time</li> <li>Turn on Balcony Heater \u2013 Turn on Balcony Heater when it's cold and Desk Lamp or Working Display are turned on</li> <li>Turn on Humidifier only during sleep time</li> </ul>"},{"location":"config/#light","title":"\ud83d\udca1 Light","text":"<ul> <li>Presence Simulation in Away Mode \u2013 Toggle Presence Simulation during Night in Away Mode</li> <li>Toggle Desk Lamp with Working Display \u2013 Sync Desk lamp with Working Display</li> <li>Turn off Corridor Light When Door is Closed \u2013 Turn off Corridor Light when Front Door closes. If the light is still on, then send a notification with an action to turn off the light.</li> <li>Turn on Corridor Light when Door is open \u2013 Turn on Corridor Light when Front Door opens and then turn it off after a few minutes</li> <li>Turn on lights on Sunset \u2013 Turn on lights when sun goes below the horizon</li> <li>Turn on lights on low illuminance \u2013 Turn on lights on low illuminance</li> </ul>"},{"location":"config/#media","title":"\ud83c\udfb5 Media","text":"<ul> <li>Turn off Samsung TV when PlayStation turns off \u2013 Turn off Samsung TV when PS5 goes to sleep mode</li> <li>Turn on Apple TV when Samsung TV turns on \u2013 Turn on Apple TV when Samsung TV turns on and PS5 is off</li> <li>Turn on Apple TV when Samsung TV turns on \u2013 Turn on Apple TV when Samsung TV turns on and PS5 is off</li> </ul>"},{"location":"config/#mode","title":"\ud83d\udea6 Mode","text":"<ul> <li>Away Flow \u2013 Toggle Away mode depending on the Away input boolean</li> <li>Away on Leaving City \u2013 Toggle Away mode depending on proximity to the Kyiv city</li> <li>Do Not Disturb Activation \u2013 Adjust devices to Do Not Disturb mode</li> <li>Do Not Disturb on Focus \u2013 Switch Do Not Disturb while camera, mic or focus are on</li> </ul>"},{"location":"config/#presence","title":"\ud83d\udd18 Presence","text":"<ul> <li>Everyone is Arriving \u2013 Turn on things when people are arriving</li> <li>Everyone is Leaving \u2013 Turn off things when people are leaving</li> </ul>"},{"location":"config/#system","title":"\ud83d\udda5\ufe0f System","text":"<ul> <li>Home Assistant Release \u2013 Notify Denys about new Home Assistant releases</li> <li>Home Assistant Start \u2013 Notify Denys when Home Assistant starts</li> <li>Magic Cube Actions</li> <li>Notify about HACS updates \u2013 Notify when new HACS components are released</li> <li>Notify about high CPU usage \u2013 Send alert when HA has a high CPU usage</li> <li>Notify about high RAM usage \u2013 Notify when RAM usage is high for some time.</li> <li>Notify when Media disk is full \u2013 Notify when Media drive is 90% full for some time.</li> <li>Notify when System disk is full \u2013 Send a notification when system disk is 90% full.</li> <li>Power Outage Recovery</li> <li>Run chores in config folder \u2013 Run scripts for generating README, commiting regular updated, etc</li> </ul>"},{"location":"config/#vacuum","title":"\ud83e\uddf9 Vacuum","text":"<ul> <li>Ask Regular Cleaning \u2013 Regular vacuum cleaning every two days</li> <li>Ask for Maintenance \u2013 Send vacuum near trash bin and ask for maintenance</li> <li>Clean Counting \u2013 Count cleanings via counter</li> <li>Error Alert \u2013 Notify when error with vacuum occured</li> <li>Finish Alert \u2013 Notify when vacuum finished cleaning and we are not home.</li> <li>Replacements Alert \u2013 Notify when vacuum parts need to be replaced</li> <li>Stop cleaning when we return home \u2013 Send vacuum home when somebody comes home</li> <li>iOS Actions \u2013 Handle iOS actions for vacuum cleaner</li> </ul>"},{"location":"config/#water","title":"\ud83d\udca6 Water","text":"<ul> <li>Keep Water Heater turned On \u2013 When Water Heater was accidentally turned off, automatically turn in on</li> <li>Notify when water is heated \u2013 When we ask to let us know when the boiler has done heating, it should notify about that.</li> </ul>"},{"location":"config/#addons","title":"Addons","text":"<p>These addons provide additional functionality for my Home Assistant instance.</p> <ul> <li>Advanced SSH &amp; Web Terminal v17.3.0 \u2013 A supercharged SSH &amp; Web Terminal access to your Home Assistant instance</li> <li>File editor v5.8.0 \u2013 Simple browser-based file editor for Home Assistant</li> <li>ESPHome v2024.5.2 \u2013 ESPHome add-on for intelligently managing all your ESP8266/ESP32 devices</li> <li>PS5 MQTT v1.3.3 \u2013 Control Sony PlayStation 5 devices via MQTT</li> <li>AirCast v4.2.1 \u2013 AirPlay capabilities for your Chromecast devices.</li> <li>Home Assistant Google Drive Backup v0.112.1 \u2013 Automatically manage backups between Home Assistant and Google Drive</li> <li>Samba share v12.3.1 \u2013 Expose Home Assistant folders with SMB/CIFS</li> <li>Mosquitto broker v6.4.0 \u2013 An Open Source MQTT broker</li> <li>Zigbee2MQTT v1.37.1-1 \u2013 Use your ZigBee devices without the vendor's bridge or gateway</li> </ul>"},{"location":"config/custom-extensions/","title":"Custom Extensions","text":"<p>Home Assistant has a lot of integrations, but sometimes it's not enough. Fortunately, Home Assistant provides a way to add external integrations.</p> <p>Below you will find integrations and Lovelace cards developed by me and by other smart-home enthusiasts.</p> <p>I use HACS for managing my third-party integrations and cards.</p>"},{"location":"config/custom-extensions/#developed-by-me","title":"Developed by Me","text":"<p>Sometimes even extensions provided by HACS are not enough, so I had to develop some extensions by myself.</p>"},{"location":"config/custom-extensions/#lovelace-cards","title":"Lovelace Cards","text":""},{"location":"config/custom-extensions/#vacuum-card","title":"<code>vacuum-card</code>","text":"<p>By default, Home Assistant does not provide any card for controlling vacuum cleaners. This card displays the state and allows you to control your robot.</p> <p></p>"},{"location":"config/custom-extensions/#purifier-card","title":"<code>purifier-card</code>","text":"<p>As for vacuums, Home Assistant doesn't provide any card for controlling air purifiers either. This card displays the state and allows to control your air purifier.</p> <p></p>"},{"location":"config/custom-extensions/#third-party","title":"Third party","text":"<p>Here's a list of extensions developed by other developers.</p>"},{"location":"config/custom-extensions/#lovelace-cards_1","title":"Lovelace Cards","text":"<ul> <li><code>mini-media-player</code> \u2014 The default one looks not so elegant and has way fewer options to display.</li> <li><code>mini-graph-card</code> \u2014 This one has a ton of different options. The killer feature for me: the ability to animate and display multiple graphs.</li> </ul>"},{"location":"config/custom-extensions/#integrations","title":"Integrations","text":"<ul> <li>Adaptive Lighting v1.22.0</li> <li>Car Wash v1.5.7</li> <li>Ecoflow-Cloud v0.13.3</li> <li>HACS v1.34.0</li> <li>Multiscrape scraping component v7.0.0</li> <li>Nova Poshta v1.1.0</li> <li>Powercalc vv1.12.3</li> <li>Presence Simulation v4.8</li> <li>Proxmox VE v3.4.1</li> <li>Snowtire Sensor v1.4.9</li> <li>Thermal Comfort v2.2.2</li> <li>Watchman v0.5.1</li> </ul>"},{"location":"config/dashboards/","title":"Dashboards","text":"<p>Below you're going to find my dashboards. I use those to display information and control accessories in my smart home.</p> <p>Warning</p> <p>I constantly update my smart home setup and tweaking UI to match my needs. Please, beware that the look of these dashboards on screenshots might differ from how they actually look right now.</p> <p>Please, visit the repo to see the current state of these dashboards.</p> <p>I use <code>mini-media-player</code> card for the media players and <code>mini-graph-card</code> for the graphs.</p>"},{"location":"config/dashboards/#home","title":"Home","text":"<p>This dashboard displays the information about my home in general.</p> <ul> <li>Room buttons navigate to the room dashboards on the press, and turn off all lights in the room on hold.</li> <li>Scenes controls of the scenes are located at the beginning of the dashboard to be accessible on the phone right away.</li> <li>Media block helps to control my smart speakers and Spotify.</li> <li>Conditions contain information about the weather, indoor temperature, humidity, and pressure, UV-index outdoors, and AQI indoor as well as outdoor (from the nearby AQI station).</li> <li>Live Camera shows a livestream of what is going on at home.</li> <li>Status display the information about our location and travel history for the last hours.</li> </ul> <p></p> <p>Room buttons navigate to subviews for each of the room, displaying controls for lights, speakers, showing room conditions.</p> Living RoomBedroomBalconyBathroom <p></p> <p></p> <p></p> <p></p>"},{"location":"config/dashboards/#vacuum","title":"Vacuum","text":"<p>This dashboard is for controlling a vacuum cleaner robot. Vacuum card for controlling a vacuum cleaner and scrips for quick access to the vacuum, which is hidden under the bed. I developed my own <code>vacuum-card</code> for vacuum management.</p> <p></p>"},{"location":"config/dashboards/#city","title":"City","text":"<p>This dashboard is created for monitoring city conditions.</p> <ul> <li>Air Quality displays AQI in my neighbourhood and Kyiv average, PM2.5 concentration indoor/outdoor and AQI map.</li> <li>Traffic displays realtime traffic map, congestion and traveltime to/from city center.</li> </ul> <p></p>"},{"location":"config/dashboards/#system","title":"System","text":"<p>This dashboard lets me overview the state of my smart home SystemHealthRegistration</p> <ul> <li>Internet and System section displays the Internet speed, ping, and connected devices. Below there are a group of sensor for CPU, RAM, Swap and Disk usage of my Raspberry Pi.</li> <li>PiHole let me monitor the DNS ad-blocking rates.</li> </ul> <p></p> State of UI at 2022"},{"location":"config/dashboards/#home_1","title":"Home","text":""},{"location":"config/dashboards/#living-room","title":"Living Room","text":""},{"location":"config/dashboards/#bedroom","title":"Bedroom","text":""},{"location":"config/dashboards/#balcony","title":"Balcony","text":""},{"location":"config/dashboards/#vacuum_1","title":"Vacuum","text":""},{"location":"config/dashboards/#car","title":"Car","text":"<p>This dashboard lets me control my Toyota vehicle.</p> <ul> <li>Alarm controls let my arm/disarm my smart alarm, start/stop the engine, trigger horn.</li> <li>History map display the 24-hour path history of the vehicle.</li> <li>States are displaying the sensor states of the hood, doors, trunk, engine and interior temperature, connection quality.</li> </ul> <p>Info</p> <p>You may see that most of the controls and sensors are unavailable on the screenshots. That's because I keep my car in the underground parking, where the GSM connection is poor.</p> <p>Though, there's no need to worry, since the parking is secured with many security systems.</p> <p></p>"},{"location":"config/dashboards/#city_1","title":"City","text":"<p>This dashboard is created for monitoring city conditions.</p> <ul> <li>Air Quality displays AQI in my neighbourhood and Kyiv average, PM2.5 concentration indoor/outdoor and AQI map.</li> <li>Traffic displays realtime traffic map, congestion and traveltime to/from city center.</li> </ul> <p></p>"},{"location":"config/dashboards/#observation","title":"Observation","text":"<p>This dashboard displays status of my plants, position of the sun, etc.</p> <p></p>"},{"location":"config/dashboards/#cameras","title":"Cameras","text":"<p>This dashboard lets me watch the live streams from Kyiv (where I live) and from Chernivtsi (where I've grown up). Unfortunately, there is a very small number of publicly accessible live cameras in Kyiv. Most of them are unstable and have very poor quality.</p> <p></p>"},{"location":"config/dashboards/#system_1","title":"System","text":"<p>This dashboard lets me overview the state of my smart home SystemHealthRegistration</p> <ul> <li>Internet and System section displays the Internet speed, ping, and connected devices. Below there are a group of sensor for CPU, RAM, Swap and Disk usage of my Raspberry Pi.</li> <li>Adguard Home let me monitor the DNS ad-blocking rates.</li> </ul> <p></p>"},{"location":"config/monitoring/","title":"Monitoring","text":"<p>Things will break, this is a matter of time. The electricity outage, crashes, interference, etc.</p> <p>You just must be prepared.</p>"},{"location":"config/monitoring/#home-assistant-instance","title":"Home Assistant Instance","text":"<p>I use UptimeRobot service no notify me when my Home Assistant instance is down (critical crash, an Internet connection is lost, etc).</p> <p></p> <p>This service checks whether the page is available online. When it's not, it send an email and a push-notification to my phone.</p>"},{"location":"config/monitoring/#low-batteries-and-unavailable-devices","title":"Low Batteries and Unavailable Devices","text":"<p>I use a blueprint to get notifications for low batteries and unavailable devices:</p> <p>It has a lot of features, but I primarily just pass the list of exceptions and send a notification as a custom action.</p>"},{"location":"config/speech/","title":"Speech","text":"<p>I do most of the interactions with my smart home using my voice. This page describes my voice control setup.</p>"},{"location":"config/speech/#home-speakers","title":"Home Speakers","text":"<p>None of the existing smart speakers supports the Ukrainian language (my native and primary language). I used English (US) for my devices.</p> <p>My current smart speaker setup consists of two HomePod Minis. I've migrate to Apple speakers from Google ones, because of a better sound and tighter integration with Apple devices, specifically:</p> <ul> <li>Intercom feature is great. When I leave my home I can send a quick voice message for anyone who stay at home.</li> <li>HomeKit works locally, without Internet access. I also means that voice requests work faster.</li> <li>Sound is significantly better that on Google speakers. Listening to music is much enjoyable, the bass is more punchy.</li> <li>Find My feature is also great. I can ask \"Where is my phone?\" and the phone will ring.</li> <li>Handoff is nice, though it doesn't work well in Ukraine.</li> </ul> <p>There's also a downside of using HomePods: I still can't sync audio for Home Assistant voice announcements between speakers.</p> Previous setup with Google speakers <p>I have two Google smart speakers. I've decided to go with Google because Google Assistant is smart enough and well-integrated with different accessories.</p> <p>We use these speakers all the time, mostly asking to turn devices, activate scenes, start or stop vacuum, set timers or reminders. Besides, lack of Ukrainian language support, I'm pretty happy with these speakers. Sometimes I need to repeat my command twice for the speaker to pick up, but I consider it acceptable.</p> Google Home MiniGoogle Nest Mini <p>I got this one as a gift for New Year 2020.</p> <p></p> <p>This one I got as a gift for my birthday.</p> <p></p>"},{"location":"config/speech/#text-to-speech","title":"Text to Speech","text":"<p>I wanted to receive voice announcements for my smart home in Ukrainian. Fortunately, Google Translate TTS supports voice generation for the Ukrainian language.</p> <pre><code>tts:\n  - platform: google_translate\n    service_name: google_say\n    language: uk # Ukrainian\n</code></pre> <p>This will generate phrases and send them to any speaker to play.</p>"},{"location":"config/speech/#announcements","title":"Announcements","text":"<p>I built a nice announcements script for myself. I use it like this:</p> <pre><code>service: script.announcement\ndata:\n  # Speak on smart speakers\n  speak: true\n  # Send notifications on devices\n  notify: true\n  # Title for notification\n  title: '\u041c\u0438\u0442\u0442\u044f \u0430\u0432\u0442\u043e \ud83d\ude98\u2600\ufe0f'\n  # Opening phrases\n  openings:\n    - '\u041d\u0430\u0439\u0431\u043b\u0438\u0436\u0447\u0438\u043c\u0438 \u0434\u043d\u044f\u043c\u0438 \u043e\u0447\u0456\u043a\u0443\u0454\u0442\u044c\u0441\u044f \u0445\u043e\u0440\u043e\u0448\u0430 \u043f\u043e\u0433\u043e\u0434\u0430.'\n    - '\u0425\u043e\u0440\u043e\u0448\u0430 \u043f\u043e\u0433\u043e\u0434\u0430 \u043d\u0430\u0439\u0431\u043b\u0438\u0436\u0447\u0456 7 \u0434\u043d\u0456\u0432.'\n    - '\u041f\u0440\u043e\u0433\u043d\u043e\u0437\u0443\u0454\u0442\u044c\u0441\u044f \u0445\u043e\u0440\u043e\u0448\u0430 \u043f\u043e\u0433\u043e\u0434\u0430!'\n  # Main phrases\n  messages:\n    - '\u0414\u043e\u0440\u0435\u0447\u043d\u043e \u043f\u043e\u043c\u0438\u0442\u0438 \u043c\u0430\u0448\u0438\u043d\u0443.'\n    - '\u0412\u0430\u0440\u0442\u043e \u043f\u043e\u0457\u0445\u0430\u0442\u0438 \u043d\u0430 \u0430\u0432\u0442\u043e\u043c\u0438\u0439\u043a\u0443.'\n    - '\u0412\u0434\u0430\u043b\u0438\u0439 \u0447\u0430\u0441, \u0449\u043e\u0431 \u043f\u043e\u043c\u0438\u0442\u0438 \u0430\u0432\u0442\u043e.'\n  # Additional data for notifications\n  # Categories or page to open on notification opening\n  notify_data:\n    url: /lovelace/car\n</code></pre> <p>This script will generate a unique announcement using random phrases from <code>openings</code> and <code>messages</code>.</p> <p>The generated phrase will be spoken on smart speakers and sent as a notification to the phones. I can avoid speaking or notifying via <code>speak</code> and <code>notify</code> flags accordingly.</p> <p><code>notify_data</code> helps to pass notification categories for actionable notifications or <code>url</code> to open when I click on this notification.</p>"},{"location":"config/speech/#do-not-disturb-flow","title":"Do Not Disturb Flow","text":"<p>It would be annoying to get a speech announcement in the middle of the night or a working meeting. That's why I built Do Not Disturb mode.</p> <p>Do Not Disturb is just automation that:</p> <ul> <li>Sets the volume of smarts speakers</li> <li>Turns on/off silence modes for fans</li> <li>Turns on/off led indicators</li> <li>Stops/starts voice announcements</li> </ul> <p>\u2026 based on the current time of day (sleeping or activity time) and a switch, I can toggle whenever I want.</p>"},{"location":"config/vacuum/","title":"Vacuum Setup","text":"<p>I have a Roborock S5 Max vacuum robot. It's paired with Home Assistant using built-in Roborock integration.</p> <p>I used a <code>vacuum-card</code> I built myself for controlling my vacuum and <code>lovelace-xiaomi-vacuum-map-card</code> for displaying a live map.</p> <p>You can find the latest state of my vacuum setup here:</p> <p>Automations Scripts</p>"},{"location":"config/vacuum/#asking-to-start-cleaning","title":"Asking to start cleaning","text":"<p>I have a relatively complex set of automation for my vacuum.</p> <p>At first, I just used to start my robot every couple of days. It's not a good approach, because it always starts vacuuming right in the middle of a working call.</p> <p>Over time, I've changed logic to more complex and elegant.</p> <p>Now my vacuum sends an actionable notification asking to start cleaning, based on multiple conditions:</p> <ul> <li>Robot is docked.</li> <li>It's a working day.</li> <li>It's a time during working hours.</li> <li>Do Not Disturb mode is off. </li> <li>It's time to clean, meaning: the previous cleaning was too short to clean the whole home, or there was no cleaning in a reasonable period.</li> </ul> <p>When I think it's a good time to start cleaning, I press a button in the notification, and the robot starts cleaning.</p> <p>Additionally, the robot starts cleaning every time we leave our home, and it's time to clean.</p>"},{"location":"config/vacuum/#asking-to-clean-itself","title":"Asking to clean itself","text":"<p>I solved this issue by automatically sending it to the trash bin after every 5th cleaning.</p> <p>The tricky part here is to tell the robot where to go. There is an article that helped me solve this issue: How I set up room-cleaning automation with Google Home, Home-Assistant and Xiaomi vacuum cleaner</p> <p>Using the method described in the article, I've found the location of my trash bin. In my case, it's:</p> <pre><code>[24500, 24500];\n</code></pre> <p>Now I can send the vacuum to this spot in my home, like this:</p> <pre><code>vacuum_maintenance:\n  alias: Vacuum Maintenance\n  icon: mdi:screwdriver\n  sequence:\n    - service: vacuum.send_command\n      entity_id: vacuum.roborock\n      data:\n        command: app_goto_target\n        params: [24500, 24500] # Coordinates near the trash bin\n</code></pre>"},{"location":"config/vacuum/#cleaning-the-specific-room","title":"Cleaning the specific room","text":"<p>I made shortcuts for cleaning rooms separately. Here's a guide how to retrieve valid room number: Retrieving room numbers.</p> <p>Here are mine:</p> <pre><code>vacuum.roborock:\n  maps:\n    - flag: 0\n      name: Kyiv Home\n      rooms:\n        '16': Living Room\n        '17': Bedroom\n        '18': Corridor\n        '19': Bathroom\n        '20': Kitchen\n</code></pre> <p>Using the first number in these tuples, I can send a vacuum to clean a specific room like this:</p> <pre><code># Single Room\nvacuum_clean_kitchen:\n  alias: Vacuum Clean Kitchen\n  icon: mdi:silverware-fork-knife\n  sequence:\n    - service: vacuum.send_command\n      data:\n        entity_id: vacuum.roborock\n        command: app_segment_clean\n        params: [20]\n\n# Multiple rooms\nvacuum_clean_living_room:\n  alias: Vacuum Clean Living Room\n  icon: mdi:sofa\n  sequence:\n    - service: vacuum.send_command\n      data:\n        entity_id: vacuum.roborock\n        command: app_segment_clean\n        params: [16, 20]\n</code></pre>"},{"location":"config/war/","title":"War Safety","text":"<p>In 2022, Russia launched a full-scale invasion of Ukraine, waging a genocidal war against my country. Ukraine is being hit by all types of weapons (except nuclear) daily. Home Assistant helps me stay safe and notifies me about incoming threats.</p> <p>We hear the siren a few times a day. Life would completely stop if we went to the shelter every time the siren goes off. So, people adapt.</p> <p>In Ukraine, we tend to differentiate the levels of danger. When the siren goes off, practically everyone starts checking their phones: \"What is going on?\"</p> <p>We have various applications and Telegram channels for monitoring the type of danger, missile paths, and understanding whether we are in direct danger or can continue with our lives for another minute.</p> <p>This is what war in the 21st century looks like: you can practically monitor a missile or a drone that is trying to kill you right from your phone. This is like a Black Mirror episode in real life. \ud83d\ude05</p> <p>There are different kinds of air alarms with varying levels of danger:</p> <ul> <li>MiG-31K take off \u2013 This can happen multiple times during the day. The MiG-31K can carry a very dangerous Kh-47M2 Kinzhal hypersonic missile. Although it happens rarely, you can't predict when the missile is attached and when it is not, so most people tolerate this level of danger.</li> <li>Suicide drones attack \u2013 Usually carried out by Iranian Shahed 136 drones. Most of them get shot down, but they are still dangerous and scary. We call them \"mopeds\" or \"lawn-mowers\" because of the sound of their engine.</li> <li>Ballistic missile attack \u2013 This can happen multiple times a day. Ballistic missiles, like the 9K720 Iskander, are extremely fast (2 km/s). You have only up to 10 minutes to hide somewhere. Usually, the fastest way is to hide behind two walls (corridor or a bathroom).</li> <li>Cruise missile attack \u2013 Cruise missiles, like the Kalibr, are relatively slow and fly like a plane. Nevertheless, they can fly a long distance and easily reach any point in the country.</li> </ul> <p>Of course, the most dangerous type of attack is a combined one. This means all of the above are raining down on Ukrainian cities simultaneously. These usually happen overnight at 4:00 in the morning. The drones and cruise missiles are used to exhaust air defenses, followed by ballistic and/or hypersonic strikes.</p>"},{"location":"config/war/#monitoring-air-alerts","title":"Monitoring Air Alerts","text":"<p>Home Assistant has a built-in Ukraine Alarm integration. It monitors the nation-wide system of air alarms and toggles safety sensors in HA.</p> <p>When there is any type of danger, I send a critical notification and announce the message on my smart speakers.</p> <p>Of course, the air siren goes off on the streets, roaring across the city, so everyone hears the danger is approaching. But I made an automation to send a critical notification and speak at home speakers, so I certainly wake up to check what is going on.</p> <pre><code>id: air_siren_kyiv\nalias: 'Alert: Air Siren in Kyiv'\ndescription:\n  Air Alert announcement when we are in Kyiv. Sends critical notifications\n  and announces on speakers.\ntrigger:\n  - platform: state\n    entity_id: binary_sensor.alerts_kyiv_air\n    to: 'on'\n    from: 'off'\n    variables:\n      title: Air Alert goes off!\n  - platform: state\n    entity_id: binary_sensor.alerts_kyiv_air\n    to: 'off'\n    from: 'on'\n    variables:\n      title: It is safe now!\ncondition:\n  - alias: Someone is in Kyiv\n    condition: state\n    entity_id: sensor.family_in_kyiv\n    state: 'on'\naction:\n  - service: script.announcement\n    data:\n      title: '{{ title }}'\n      force_speak: true # Speaks even in DND mode\n      notify_data:\n        group: air-alerts\n        push:\n          sound:\n            name: default\n            critical: 1\n            volume: 0.75\n</code></pre>"},{"location":"config/war/#scraping-monitoring-channels","title":"Scraping Monitoring Channels","text":"<p>I already mentioned we have various Telegram channels for monitoring the situation during an attack. Those channels provide live updates on dangers, flight paths, and the type of attack.</p> <p>So often I found myself constantly checking my phone to understand whether I am in direct danger or can sleep for a few hours. I know it sounds crazy, and normal people would go straight to the nearby shelter, but this is life in Ukraine. You don't have to follow my reckless example. If you are in Ukraine, GO TO THE SHELTER!</p> <p>I decided to automate it. Instead of reading these channels myself, I delegate this task to HA.</p> <p>I use the HA Multiscrape custom integration for that. You may ask, \"why do you need a custom component when HA has a built-in scraping component?\" Yes, it does, but I need multiple sensors from a single scrape, and I need to work with lists of data. The built-in component has some limitations with that.</p>"},{"location":"config/war/#monitoring-imminent-danger","title":"Monitoring Imminent Danger","text":"<p>Cruise missiles are usually carried and launched by Tu-95 bombers.</p> <p>They fly to the missile launch sites for about 3 hours, launch their missiles, then it takes about 1-2 hours for missiles to fly to Kyiv. So there's some time to prepare a hideout (in my case, it's the bathroom), gather documents, and sleep for a few hours before the \"show\" begins.</p> Notification about Tu-95 bombers taking off <p>Usually, it happens in the evening and means tonight will be a massive missile attack.</p> <p>I have a sensor that checks the Telegram channels, scrapes the list of messages every 5 seconds, and checks if the latest message contains a specific set of words, like \"take off\" and \"plane\" and \"tu-95\". It also stores the latest message as an attribute.</p> <pre><code>multiscrape:\n  - name: War Monitor\n    resource: https://t.me/s/war_monitor\n    scan_interval: 5\n    list_separator: '|||'\n    binary_sensor:\n      - unique_id: imminent_attack_in_war_monitor\n        name: Imminent Attack in War Monitor\n        icon: mdi:airplane-clock\n        device_class: safety\n        select_list: '.js-message_text'\n        value_template: &gt;-\n          {% set message = value.split(\"|||\") | last | lower %}\n          {{ \"\u0437\u043b\u0456\u0442\" in message and \"\u0431\u043e\u0440\u0442\u0456\u0432\" in message and \"\u0442\u0443-95\" in message }}\n        attributes:\n          - name: latest_message\n            select_list: '.js-message_text'\n            value_template: \"{{ value.split('|||') | last }}\"\n</code></pre> <p>So when the sensor turns on, it means the bombers are airborne and it's time to get ready. A notification is sent:</p> <pre><code>alias: 'Alert: Imminent Attack by Strategic Bombers'\ndescription:\n  Send a notification when Tu-95 strategic bombers take off from Russian\n  airfields. This means an attack by cruise missiles is imminent. Prepare a hideout.\ntrigger:\n  - platform: state\n    entity_id:\n      - binary_sensor.imminent_attack_in_war_monitor\n      - binary_sensor.imminent_attack_in_operinform\n    from: 'off'\n    to: 'on'\naction:\n  - service: script.announcement\n    data:\n      service: notify.all\n      speak: false\n      notify: true\n      title: 'Bombers take off \ud83d\udeeb'\n      messages:\n        - '{{ trigger.to_state.attributes.latest_message }}'\n</code></pre>"},{"location":"config/war/#direct-danger-alert","title":"Direct Danger Alert","text":"<p>This is the most interesting sensor, which notifies me right when there's a direct threat to my location.</p> Notification about direct danger <p>When an attack happens at night, you need to decide:</p> <ul> <li>Are you going to the shelter to get a sleepless night somewhere in a basement or in the subway?</li> <li>Or are you going to stay in bed as long as possible to get some sleep, because you need to go to work tomorrow?</li> </ul> <p>Every normal person would go to the shelter. But when you live in these conditions for some time, you try to calculate the risk:</p> <ul> <li>You need to get proper sleep to be able to work.</li> <li>The air defenses are titans; they do their job excellently. Flying threats are getting shot down regularly.</li> <li>In Kyiv, the risk of a direct hit or hit by debris is relatively tolerable: I guess like being hit by a car (this estimate is completely unscientific!).</li> <li>If you are unlucky to catch a direct hit \u2013 you are dead anyway. There's very little chance to survive that.</li> <li>If the missile/drone gets shot down nearby, the shockwave will blow your windows.</li> </ul> <p>So what do you do? It's up to you, but most of the time, I decide to sleep in bed. When things get hot, I hide in a bathroom so that when something blows up nearby, I will be behind two walls from glass shards and shockwaves.</p> <p>I have a sensor that watches for specific keywords like \"Kyiv\" or a neighborhood name, for \"warning\" or \"be in a safe place\" or \"fast target\".</p> <pre><code>multiscrape:\n  - name: War Monitor\n    resource: https://t.me/s/war_monitor\n    scan_interval: 5\n    list_separator: '|||'\n    binary_sensor:\n      - unique_id: danger_in_war_monitor\n        name: Danger in War Monitor\n        icon: mdi:rocket-launch\n        device_class: safety\n        select_list: '.js-message_text'\n        value_template: &gt;-\n          {% set message = value.split(\"|||\") | last | lower %}\n          {% set in_kyiv = \"\u043a\u0438\u0457\u0432\" in message or \"\u0441\u0432\u044f\u0442\u043e\u0448\u0438\u043d\" in message %}\n          {% set danger_now = \"\u0443\u0432\u0430\u0436\u043d\u043e\" in message\n              or \"\u0448\u0432\u0438\u0434\u043a\u0456\u0441\u043d\u0430 \u0446\u0456\u043b\u044c\" in message\n              or \"\u043f\u043e\u0434\u0430\u043b\u0456 \u0432\u0456\u0434 \u0437\u043e\u0432\u043d\u0456\u0448\u043d\u0456\u0445 \u0441\u0442\u0456\u043d\" in message\n              or \"\u0431\u0435\u0437\u043f\u0435\u0447\u043d\u0438\u0445 \u043c\u0456\u0441\u0446\u044f\u0445\" in message\n          %}\n          {{ danger_now and in_kyiv }}\n        attributes:\n          - name: latest_message\n            select_list: '.js-message_text'\n            value_template: \"{{ value.split('|||') | last }}\"\n</code></pre> <p>When this sensor turns on, it means there's a direct danger to me and I should hide immediately. I send a critical notification, speak a danger message on speakers, so I can quickly wake up and go to the hideout.</p> <pre><code>alias: 'Alert: Danger in Kyiv'\ndescription: Danger of missile/drone strike in Kyiv RIGHT NOW. Critical alert to\n  hide immediately.\ntrigger:\n  - platform: state\n    entity_id:\n      - binary_sensor.danger_in_war_monitor\n      - binary_sensor.danger_in_operinform\n    from: 'off'\n    to: 'on'\naction:\n  - alias: Send a critical notification\n    service: script.announcement\n    data:\n      service: notify.all\n      speak: false\n      notify: true\n      title: Direct Danger \u26a0\ufe0f\n      messages:\n        - '{{ trigger.to_state.attributes.latest_message }}'\n      notify_data:\n        group: air-alerts\n        push:\n          sound:\n            name: default\n            critical: 1\n            volume: 1\n  - variables:\n      messages:\n        - \u0423\u0432\u0430\u0433\u0430! \u041f\u0440\u044f\u043c\u0430 \u0437\u0430\u0433\u0440\u043e\u0437\u0430 \u0443\u0434\u0430\u0440\u0443!\n        - \u0423\u0432\u0430\u0433\u0430 \u0437\u0430\u0433\u0440\u043e\u0437\u0430 \u0443\u0434\u0430\u0440\u0443 \u043f\u043e \u041a\u0438\u0454\u0432\u0443!\n        - \u0423\u0432\u0430\u0433\u0430! \u041d\u0435\u0433\u0430\u0439\u043d\u043e \u043f\u0435\u0440\u0435\u0439\u0434\u0456\u0442\u044c \u0434\u043e \u0441\u0445\u043e\u0432\u043a\u0443!\n        - \u0423\u0432\u0430\u0433\u0430! \u041d\u0435\u0433\u0430\u0439\u043d\u043e \u0441\u0445\u043e\u0432\u0430\u0439\u0442\u0435\u0441\u044c!\n        - \u0423\u0432\u0430\u0433\u0430! \u041f\u0440\u044f\u043c\u0430 \u0437\u0430\u0433\u0440\u043e\u0437\u0430!\n        - \u0423\u0432\u0430\u0433\u0430! \u041d\u0435\u0433\u0430\u0439\u043d\u043e \u0441\u0445\u043e\u0432\u0430\u0439\u0442\u0435\u0441\u044c!\n        - \u0423\u0432\u0430\u0433\u0430! \u0410\u0442\u0430\u043a\u0430 \u043d\u0430 \u041a\u0438\u0457\u0432!\n  - service: media_player.volume_set\n    entity_id:\n    data:\n      volume_level: 0.6\n    target:\n      device_id: media_player.bedroom_homepod\n  - alias: Speak in Bedroom\n    service: script.announcement\n    data:\n      speak: true\n      speaker: media_player.bedroom_homepod\n      notify: false\n      force_speak: true\n      messages: '{{ messages }}'\n  - delay:\n      hours: 2\n</code></pre>"}]}