do_not_disturb_mode:
  alias: Do Not Disturb Mode
  description: A flow for switching home into DND mode and back to normal
  sequence:
    - choose:
        - conditions:
            - condition: state
              entity_id: input_boolean.do_not_disturb
              state: 'on'
          sequence:
            - alias: Make purifier work silently
              service: fan.set_preset_mode
              target:
                entity_id: fan.air_purifier
              data:
                preset_mode: Silent

            - alias: No LED light on humidifier
              service: switch.turn_off
              entity_id: switch.air_humidifier_led

            - alias: Speakers should not yell
              service: media_player.volume_set
              data:
                entity_id:
                  - media_player.living_room_speaker
                  - media_player.bedroom_speaker
                volume_level: 0.2

      default:
        - alias: Make Purifier work normaly
          service: fan.set_preset_mode
          target:
            entity_id: fan.air_purifier
          data:
            preset_mode: Auto

        - alias: Turn on Humdifier's LED light
          service: switch.turn_on
          entity_id: switch.air_humidifier_led

        - alias: Speakers set to normal volume
          service: media_player.volume_set
          data:
            entity_id:
              - media_player.living_room_speaker
              - media_player.bedroom_speaker
            volume_level: 0.6

away_mode:
  alias: Away Mode
  description: A flow for switching into Away mode
  sequence:
    - alias: Switch to Away Mode or restore from it
      choose:
        - conditions:
            condition: state
            entity_id: input_boolean.away
            state: 'on'
          sequence:
            - alias: Notify about Away Mode activation
              service: script.announcement
              data:
                speak: false
                title: –î–∞–ª–µ–∫–æ –≤—ñ–¥ –¥–æ–º—É üèÉ
                greetings:
                  - –†–µ–∂–∏–º ¬´–î–∞–ª–µ–∫–æ –≤—ñ–¥ –¥–æ–º—É¬ª —É–≤—ñ–º–∫–Ω–µ–Ω–æ.
                  - –†–µ–∂–∏–º ¬´–î–∞–ª–µ–∫–æ –≤—ñ–¥ –¥–æ–º—É¬ª –∞–≤—Ç–∏–≤–æ–≤–∞–Ω–æ.
                  - –ê–∫—Ç–∏–≤–æ–≤–∞–Ω–æ —Ä–µ–∂–∏–º ¬´–î–∞–ª–µ–∫–æ –≤—ñ–¥ –¥–æ–º—É¬ª.
                messages:
                  - –í–º–∏–∫–∞—î—Ç—å—Å—è —Å–∏–º—É–ª—è—Ü—ñ—è –ø—Ä–∏—Å—É—Ç–Ω–æ—Å—Ç—ñ.
                  - –ì–æ—Ç—É—î–º–æ –¥—ñ–º –¥–æ –≤–∞—à–æ—ó –≤—ñ–¥—Å—É—Ç–Ω–æ—Å—Ç—ñ.
                  - –©–∞—Å–ª–∏–≤–æ—ó –¥–æ—Ä–æ–≥–∏!
                notify_data:
                  group: system
                  tag: away-mode

            - alias: Arm Alarm
              service: alarm_control_panel.alarm_arm_away
              entity_id: alarm_control_panel.home_alarm

            - alias: Turn on Presence Simulation
              service: presence_simulation.start

            - alias: Turn off Water Heater
              service: switch.turn_off
              entity_id: switch.water_heater

            - alias: Climate Adjustments
              choose:
                - alias: Set TRV to Away during Heating Season
                  conditions:
                    condition: state
                    entity_id: binary_sensor.heating_season
                    state: 'on'
                  sequence:
                    - alias: Set TRVs to away
                      service: climate.set_preset_mode
                      data:
                        entity_id:
                          - climate.living_room_heater
                          - climate.bedroom_heater
                        preset_mode: away

      default:
        - alias: Notify about Away Mode activation
          service: script.announcement
          data:
            speak: false
            title: –î–∞–ª–µ–∫–æ –≤—ñ–¥ –¥–æ–º—É üèÉ
            greetings:
              - –†–µ–∂–∏–º ¬´–î–∞–ª–µ–∫–æ –≤—ñ–¥ –¥–æ–º—É¬ª –≤–∏–º–∫–Ω–µ–Ω–æ.
              - –†–µ–∂–∏–º ¬´–î–∞–ª–µ–∫–æ –≤—ñ–¥ –¥–æ–º—É¬ª –¥–µ–∞–∫—Ç–∏–≤–æ–≤–∞–Ω–æ.
              - –î–µ–∞–∫—Ç–∏–≤–æ–≤–∞–Ω–æ —Ä–µ–∂–∏–º ¬´–î–∞–ª–µ–∫–æ –≤—ñ–¥ –¥–æ–º—É¬ª.
            messages:
              - –í–∏–º–∏–∫–∞—î–º–æ —Å–∏–º—É–ª—è—Ü—ñ—é –ø—Ä–∏—Å—É—Ç–Ω–æ—Å—Ç—ñ.
              - –ì–æ—Ç—É—î–º–æ –¥—ñ–º –¥–æ –≤–∞—à–æ–≥–æ –ø—Ä–∏–±—É—Ç—Ç—è.
              - –í—ñ—Ç–∞—é –∑ –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è–º!
            notify_data:
              group: system
              tag: away-mode

        - alias: Disarm Alarm
          service: alarm_control_panel.alarm_disarm
          entity_id: alarm_control_panel.home_alarm

        - alias: Suggest cleaning home before arrival
          service: script.announcement
          data:
            speak: false
            title: '–ü–∏–ª–æ—Å–æ—Å üßπ'
            greetings:
              - C—Ö–æ–∂–µ –≤–∞—Å –¥–∞–≤–Ω–æ –Ω–µ –±—É–ª–æ –≤–¥–æ–º–∞.
              - –í–∏ –±—É–ª–∏ –¥–∞–ª–µ–∫–æ –≤—ñ–¥ –¥–æ–º—É.
              - –í–∏ –Ω–∞ –ø—ñ–¥—Ö–æ–¥—ñ –¥–æ–¥–æ–º—É!
            messages:
              - '–ü—Ä–∏–±—Ä–∞—Ç–∏ –≤–¥–æ–º–∞?'
              - '–ü—Ä–∏–±–∏—Ä–∞—Ç–∏ –ø–µ—Ä–µ–¥ –ø—Ä–∏—ó–∑–¥–æ–º?'
              - '–ë–∞–∂–∞—î—Ç–µ –ø—Ä–∏–±—Ä–∞—Ç–∏ –ø–µ—Ä–µ–¥ –ø—Ä–∏–±—É—Ç—Ç—è–º?'
              - '–ü–æ—á–∞—Ç–∏ –ø—Ä–∏–±–∏—Ä–∞–Ω–Ω—è?'
              - "{{ state_attr('vacuum.roborock', 'friendly_name') }} –ø—Ä–æ–ø–æ–Ω—É—î –¥–æ–º–∞—à–Ω—î –ø—Ä–∏–±–∏—Ä–∞–Ω–Ω—è."
              - "{{ state_attr('vacuum.roborock', 'friendly_name') }} —Ö–æ—á–µ –ø—Ä–∏–±–∏—Ä–∞—Ç–∏ –∫–≤–∞—Ä—Ç–∏—Ä—É."
              - "{{ state_attr('vacuum.roborock', 'friendly_name') }} –¥–∞–≤–Ω–æ –Ω–µ –ø—Ä–∏–±–∏—Ä–∞–≤. –ü–æ—á–∞—Ç–∏?"
            notify_data:
              url: /lovelace/vacuum
              group: vacuum
              tag: vacuum-cleaning
              actions:
                - action: VACUUM_START
                  title: –ü–æ—á–∞—Ç–∏ –ø—Ä–∏–±–∏—Ä–∞–Ω–Ω—è
                  activationMode: background
                  authenticationRequired: true

        - alias: Turn off Presence Simulation
          service: presence_simulation.stop

        - alias: Turn on Water Heater
          service: switch.turn_on
          entity_id: switch.water_heater

        - alias: Climate Adjustments
          choose:
            - alias: Home is cold during Heating Season
              conditions:
                - condition: state
                  entity_id: binary_sensor.heating_season
                  state: 'on'
                - condition: numeric_state
                  entity_id: sensor.home_temperature
                  below: 21
              sequence:
                - alias: Set TRVs to boost
                  service: climate.set_preset_mode
                  data:
                    entity_id:
                      - climate.living_room_heater
                      - climate.bedroom_heater
                    preset_mode: 'boost'

            - alias: Home is overheated during Summer
              conditions:
                - condition: state
                  entity_id: binary_sensor.heating_season
                  state: 'off'
                - condition: numeric_state
                  entity_id: sensor.home_temperature
                  above: 25
              sequence:
                - alias: Set ACs to cool down
                  service: climate.set_temperature
                  data:
                    entity_id:
                      - climate.living_room_ac
                      - climate.bedroom_ac
                    temperature: 18
                    hvac_mode: 'cool'

                - alias: Wait for home to cool down
                  wait_for_trigger:
                    platform: numeric_state
                    entity_id: sensor.home_temperature
                    below: 24
                  timeout:
                    hours: 1

                - alias: Turn off ACs and set temperature to normal
                  service: climate.set_temperature
                  data:
                    entity_id:
                      - climate.living_room_ac
                      - climate.bedroom_ac
                    temperature: 22
                    hvac_mode: 'off'
